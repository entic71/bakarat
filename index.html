<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>강남랜드 — 단계형 코인 게임</title>
<title>화려한 코인 배팅 게임</title>
<style>
:root{--bg:#071e3a;--panel:#0b2740;--accent:#0ea5ff;--accent2:#00b4ff;--muted:#9fb6d9}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;background:linear-gradient(180deg,#061427 0%,#04233b 100%);color:#e6f0ff}
.container{max-width:1100px;margin:28px auto;padding:20px;display:grid;grid-template-columns:320px 1fr;gap:20px}
.panel{background:var(--panel);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 8px 28px rgba(2,6,23,0.6)}
.brand{display:flex;align-items:center;gap:12px}.brand .logo{font-weight:800;font-size:20px;color:var(--accent)}
label{display:block;margin-top:10px;color:var(--muted);font-size:13px}
input[type=text],input[type=password],input[type=number]{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;margin-top:6px}
.btn{display:inline-block;padding:10px 12px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#002236;font-weight:700;border:none;cursor:pointer}
.btn.alt{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent)}
.muted{color:var(--muted);font-size:13px}
table{width:100%;border-collapse:collapse;margin-top:10px}th,td{padding:6px;text-align:left;font-size:13px}thead th{color:var(--muted);font-weight:600}
.game{background:var(--panel);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 28px rgba(2,6,23,0.6)}
.toprow{display:flex;align-items:center;gap:12px}.credits{font-size:18px;font-weight:800;color:var(--accent)}.stage{margin-left:auto;color:var(--muted)}
.coin-wrap{display:flex;flex-direction:column;align-items:center;margin:18px 0}.coin{width:140px;height:140px;border-radius:50%;position:relative;transform-style:preserve-3d;cursor:pointer}
.coin-face{position:absolute;inset:0;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:20px;backface-visibility:hidden;border:6px solid rgba(255,255,255,0.04)}
.coin-front{background:radial-gradient(circle at 30% 25%, #bff1ff, #60c0ff);box-shadow:0 10px 30px rgba(6,139,206,0.12)}
.coin-back{background:radial-gradient(circle at 70% 75%, #8fd1ff, #0ea5ff);transform:rotateY(180deg);box-shadow:0 10px 30px rgba(6,139,206,0.08)}
.coin.spin{animation:spin 1.2s cubic-bezier(.2,.8,.2,1)}
.coin.heads{transform:rotateY(0deg)}.coin.tails{transform:rotateY(180deg)}
@keyframes spin{from{transform:rotateY(0)}to{transform:rotateY(1440deg)}}
.glow{width:220px;height:220px;border-radius:50%;filter:blur(30px);opacity:0.9;position:absolute;z-index:-1}
.glow.win{background:radial-gradient(circle,#8ef3ff, transparent 45%)}
.glow.lose{background:radial-gradient(circle,#7fb8ff, transparent 45%)}
.controls{display:flex;gap:10px;margin-top:12px}.controls .wide{flex:1}
#log{margin-top:12px;padding:12px;background:rgba(255,255,255,0.03);border-radius:10px;min-height:120px;overflow:auto}.log-item{font-size:13px;color:var(--muted);margin-bottom:6px}
/* 팝업 */
.modal-back{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;z-index:100}
.modal{background:var(--panel);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);min-width:320px}
:root{
  --bg:#0b0b0b;
  --accent:#58a6ff;
  --win:#8ef3ff;
  --lose:#ff6f6f;
  --panel:#111;
  --muted:#9ba1a7;
}
html,body{margin:0;height:100%;font-family:'Pretendard','Inter',sans-serif;background:radial-gradient(circle,#1a1a1a,#0b0b0b);color:#fff;overflow-x:hidden;}
header{padding:20px;text-align:center;font-size:2em;color:var(--accent);}
.main-panel{max-width:600px;margin:20px auto;padding:20px;border-radius:16px;background:linear-gradient(135deg,#222,#111);box-shadow:0 0 30px rgba(0,0,0,0.7);position:relative;animation:panelGlow 3s infinite alternate;}
@keyframes panelGlow{
  0%{box-shadow:0 0 10px #58a6ff,0 0 20px #8ef3ff;}
  50%{box-shadow:0 0 20px #fff,0 0 40px #58a6ff;}
  100%{box-shadow:0 0 10px #8ef3ff,0 0 20px #58a6ff;}
}
.toprow{display:flex;justify-content:space-between;margin-bottom:10px;font-weight:600;}
.toprow div{background:rgba(255,255,255,0.05);padding:6px 10px;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.5);}
.prob-preview, .mult-preview, .payout-preview{margin:5px 0;text-align:center;font-size:1em;font-weight:600;}
.coin-container{position:relative;height:150px;margin:20px auto;display:flex;justify-content:center;align-items:center;}
.coin{width:100px;height:100px;background:radial-gradient(circle,#fff,#aaa);border-radius:50%;box-shadow:0 0 20px #fff;cursor:pointer;animation:coinPulse 1s infinite alternate;}
@keyframes coinPulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
button{padding:10px 20px;margin:5px;background:linear-gradient(90deg,#58a6ff,#8ef3ff);border:none;color:#fff;font-weight:700;border-radius:10px;cursor:pointer;box-shadow:0 0 10px #58a6ff,0 0 20px #8ef3ff;transition:0.2s;}
button:hover{transform:scale(1.1);box-shadow:0 0 20px #fff,0 0 40px #58a6ff;}
.glow{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:16px;pointer-events:none;z-index:10;opacity:0;}
.glow.win{background:radial-gradient(circle,#8ef3ff,transparent 45%);animation:glowAnim 0.6s ease;}
.glow.lose{background:radial-gradient(circle,#ff6f6f,transparent 45%);animation:glowAnim 0.6s ease;}
@keyframes glowAnim{0%{opacity:0}50%{opacity:1}100%{opacity:0}}
#log{margin-top:20px;max-height:200px;overflow-y:auto;padding:10px;background:rgba(255,255,255,0.05);border-radius:10px;font-size:0.9em;}
input{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:#fff;}
</style>
</head>
<body>
<div class="container">
  <div class="panel">
    <div class="brand"><div class="logo">강남랜드</div></div>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="btnLogin" class="btn">로그인</button>
      <button id="btnSignup" class="btn alt">회원가입</button>
    </div>
    <div class="muted" style="margin-top:10px">기본 100크레딧으로 시작</div>
    <hr style="margin:14px 0;border:none;height:1px;background:rgba(255,255,255,0.03)">
    <h3>랭킹</h3>
    <table id="rankPreview"><thead><tr><th>순위</th><th>학번</th><th>크레딧</th></tr></thead><tbody></tbody></table>

<header>화려한 코인 배팅 게임</header>

<div class="main-panel">
  <div class="toprow">
    <div>크레딧: <span id="credits">1000</span></div>
    <div>단계: <span id="stageLabel">0</span></div>
</div>
  <div class="game">
    <div class="toprow"><div class="credits">크레딧: <span id="credits">0</span></div><div class="stage">단계: <strong id="stageLabel">-</strong></div></div>
    <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
      <label>배팅 금액</label>
      <input id="bet" type="number" value="10" min="1">
    </div>
    <div style="position:relative;display:flex;flex-direction:column;align-items:center">
      <div id="glow" class="glow" style="display:none"></div>
      <div class="coin-wrap">
        <div id="coin" class="coin heads">
          <div class="coin-face coin-front">앞면</div>
          <div class="coin-face coin-back">뒷면</div>
        </div>
      </div>
    </div>
    <div class="controls">
      <button id="startBtn" class="btn wide">게임 시작</button>
      <button id="goBtn" class="btn wide" disabled>GO</button>
      <button id="stopBtn" class="btn wide" disabled>STOP</button>
    </div>
    <div id="log"></div>
  <div class="prob-preview">성공확률: <span id="stageProb">-</span>%</div>
  <div class="mult-preview">예상 배율: <span id="stageMult">-</span>x</div>
  <div class="payout-preview">예상 수익: <span id="stagePayout">-</span></div>
  
  <div style="margin:10px 0;">
    <input type="number" id="bet" placeholder="배팅액 입력" min="1" value="100">
</div>
</div>

<!-- 로그인/회원가입 팝업 -->
<div class="modal-back" id="authModal">
  <div class="modal">
    <h3 id="authTitle">로그인</h3>
    <label>학번</label>
    <input id="authId" type="text" placeholder="학번 입력">
    <label>비밀번호</label>
    <input id="authPwd" type="password" placeholder="비밀번호 입력">
    <button id="authBtn" class="btn wide">확인</button>
    <button id="switchAuth" class="btn alt wide" style="margin-top:6px">회원가입 전환</button>
  <div class="coin-container">
    <div id="coin" class="coin"></div>
</div>

  <div style="text-align:center;">
    <button id="btn-go">GO</button>
    <button id="btn-stop">STOP</button>
  </div>

  <div id="log"></div>

  <div class="glow" id="glow"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getDatabase, ref, push, onValue, set, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

const FIREBASE_CONFIG = {
apiKey: "AIzaSyAaYIB1Ows4tOVIQotQCyFHFR2h3pBEeTg",
@@ -98,129 +81,83 @@ <h3 id="authTitle">로그인</h3>
messagingSenderId: "204994545121",
appId: "1:204994545121:web:d3e6879b5061781b433ea0"
};

const app = initializeApp(FIREBASE_CONFIG);
const db = getDatabase(app);
const usersRef = ref(db,'users');

const stages=[
  {name:'1단계',prob:0.8,mult:1.1},{name:'2단계',prob:0.7,mult:1.3},
  {name:'3단계',prob:0.6,mult:1.5},{name:'4단계',prob:0.5,mult:1.8},
  {name:'5단계',prob:0.3,mult:2.5},{name:'6단계',prob:0.2,mult:4},
  {name:'7단계',prob:0.1,mult:8}
let currentCredits = 1000;
let currentStageIndex = 0;
let stages = [
  {name:"1단계",prob:0.9,mult:1.2},
  {name:"2단계",prob:0.7,mult:1.5},
  {name:"3단계",prob:0.5,mult:2.0},
  {name:"4단계",prob:0.3,mult:3.0},
  {name:"5단계",prob:0.1,mult:5.0}
];

// DOM
const rankPreviewTbody=document.querySelector('#rankPreview tbody'),
creditsEl=document.getElementById('credits'),
stageLabel=document.getElementById('stageLabel'),
betEl=document.getElementById('bet'),
startBtn=document.getElementById('startBtn'),
goBtn=document.getElementById('goBtn'),
stopBtn=document.getElementById('stopBtn'),
coinEl=document.getElementById('coin'),
glowEl=document.getElementById('glow'),
logEl=document.getElementById('log'),
btnLogin=document.getElementById('btnLogin'),
btnSignup=document.getElementById('btnSignup'),
authModal=document.getElementById('authModal'),
authTitle=document.getElementById('authTitle'),
authId=document.getElementById('authId'),
authPwd=document.getElementById('authPwd'),
authBtn=document.getElementById('authBtn'),
switchAuth=document.getElementById('switchAuth');

let loginMode=true, currentUser=null, userCredits=0, currentStageIndex=-1, currentBet=0, started=false;

// 로그
function appendLog(t){let d=document.createElement('div');d.className='log-item';d.textContent=`${new Date().toLocaleTimeString()} — ${t}`;logEl.prepend(d);}

// 팝업
function openAuthModal(mode='login'){loginMode=mode==='login';authTitle.textContent=loginMode?'로그인':'회원가입';authBtn.textContent='확인';authId.value='';authPwd.value='';authModal.style.display='flex';}
function closeAuthModal(){authModal.style.display='none';}
authModal.addEventListener('click', e=>{if(e.target===authModal) closeAuthModal();});
switchAuth.addEventListener('click', ()=>openAuthModal(loginMode?'signup':'login'));
btnLogin.addEventListener('click', ()=>openAuthModal('login'));
btnSignup.addEventListener('click', ()=>openAuthModal('signup'));

// 로그인/회원가입 처리
authBtn.addEventListener('click', async()=>{
  const id=authId.value.trim(), pwd=authPwd.value.trim();
  if(!id||!pwd){alert('학번과 비밀번호 필요');return;}
  const userRef = ref(db, `users/${id}`);
  const snapshot = await get(userRef);
  if(loginMode){
    if(!snapshot.exists()){alert('회원 없음');return;}
    const data=snapshot.val();
    if(data.password!==pwd){alert('비밀번호 불일치');return;}
    currentUser=id; userCredits=data.credits||0; creditsEl.textContent=userCredits;
    appendLog(`${id} 로그인 성공`);
  } else {
    if(snapshot.exists()){alert('이미 존재하는 학번');return;}
    await set(userRef,{password:pwd,credits:100});
    alert('가입 완료! 로그인 해주세요.');
    closeAuthModal();
    return;
  }
  closeAuthModal();
  loadRankPreview();
});

// 게임
startBtn.addEventListener('click',()=>{
  if(!currentUser){alert('먼저 로그인'); return;}
  let bet=Number(betEl.value)||0; if(bet<=0||bet>userCredits){alert('배팅액 확인'); return;}
  currentBet=bet; currentStageIndex=0; started=true;
  startBtn.disabled=true; goBtn.disabled=true; stopBtn.disabled=true;
  stageLabel.textContent=stages[currentStageIndex].name;
  appendLog(`배팅 ${bet} 시작`);
  attemptStage();
});

async function attemptStage(){
  let prob=stages[currentStageIndex].prob;
  appendLog(`${stages[currentStageIndex].name} 시도 (성공확률 ${Math.round(prob*100)}%)`);
  let ok=Math.random()<prob;
  coinEl.classList.remove('heads','tails'); coinEl.classList.add('spin');
  glowEl.style.display='block'; glowEl.className='glow';
  setTimeout(async()=>{
    coinEl.classList.remove('spin'); coinEl.classList.add(ok?'heads':'tails');
    glowEl.className=ok?'glow win':'glow lose';
    if(ok){goBtn.disabled=false; stopBtn.disabled=false; appendLog('성공!');}
    else{ appendLog('실패!'); userCredits-=currentBet; if(userCredits<0)userCredits=0; creditsEl.textContent=userCredits; await set(ref(db,`users/${currentUser}/credits`),userCredits); resetRun();}
  },1200);
const creditsEl = document.getElementById('credits');
const stageLabel = document.getElementById('stageLabel');
const stageProb = document.getElementById('stageProb');
const stageMult = document.getElementById('stageMult');
const stagePayout = document.getElementById('stagePayout');
const betEl = document.getElementById('bet');
const coinEl = document.getElementById('coin');
const glowEl = document.getElementById('glow');
const logEl = document.getElementById('log');

function appendLog(msg){logEl.innerHTML+=msg+'<br>'; logEl.scrollTop=logEl.scrollHeight;}

function updateStagePreview(){
  if(currentStageIndex>=stages.length){stageProb.textContent='-';stageMult.textContent='-';stagePayout.textContent='-';return;}
  const stage = stages[currentStageIndex];
  stageLabel.textContent=currentStageIndex+1;
  stageProb.textContent=Math.round(stage.prob*100);
  stageMult.textContent=stage.mult.toFixed(2);
  const bet = parseInt(betEl.value)||0;
  stagePayout.textContent=Math.floor(bet*stage.mult);
}

goBtn.addEventListener('click',()=>{
  if(!started||currentStageIndex>=stages.length-1)return;
  currentStageIndex++; stageLabel.textContent=stages[currentStageIndex].name;
  goBtn.disabled=true; stopBtn.disabled=true; appendLog(`다음 단계: ${stages[currentStageIndex].name}`);
  attemptStage();
});
betEl.addEventListener('input',updateStagePreview);

function attemptStage(){
  if(currentStageIndex>=stages.length){appendLog('모든 단계 완료!');return;}
  const stage = stages[currentStageIndex];
  const bet = parseInt(betEl.value)||0;
  if(bet>currentCredits){alert('크레딧이 부족합니다!');return;}
  appendLog(stage.name+' 시도 (성공확률 '+Math.round(stage.prob*100)+'%)');
  coinEl.classList.add('spin');
  glowEl.style.opacity='1';
  setTimeout(()=>{
    coinEl.classList.remove('spin');
    let success = Math.random()<stage.prob;
    glowEl.className=success?'glow win':'glow lose';
    if(success){
      currentStageIndex++;
      appendLog('성공! 다음 단계로 이동.');
    } else {
      currentCredits-=bet;
      creditsEl.textContent=currentCredits;
      appendLog('실패! 크레딧 차감.');
      currentStageIndex=0;
    }
    updateStagePreview();
    setTimeout(()=>glowEl.style.opacity='0',600);
  },1000);
}

stopBtn.addEventListener('click', async()=>{
  if(!started)return;
  let payout=Math.floor(currentBet*stages[currentStageIndex].mult);
  appendLog(`STOP 회수: ${payout}`);
  userCredits+=payout; creditsEl.textContent=userCredits;
  await set(ref(db,`users/${currentUser}/credits`),userCredits);
  resetRun();
document.getElementById('btn-go').addEventListener('click',attemptStage);
document.getElementById('btn-stop').addEventListener('click',()=>{
  const bet = parseInt(betEl.value)||0;
  if(bet>currentCredits){alert('크레딧이 부족합니다!');return;}
  const stage = stages[currentStageIndex];
  const payout = Math.floor(bet*stage.mult);
  currentCredits+=payout;
  creditsEl.textContent=currentCredits;
  appendLog('STOP! '+payout+' 크레딧 획득.');
  currentStageIndex=0;
  updateStagePreview();
});

function resetRun(){currentStageIndex=-1;started=false;currentBet=0;startBtn.disabled=false;goBtn.disabled=true;stopBtn.disabled=true;stageLabel.textContent='-';glowEl.style.display='none';}

// 랭킹
async function loadRankPreview(){
  onValue(usersRef, snapshot=>{
    const data=snapshot.val()||{};
    const arr=Object.entries(data).map(([id,val])=>({id,credits:val.credits||0})).sort((a,b)=>b.credits-a.credits).slice(0,5);
    rankPreviewTbody.innerHTML='';
    arr.forEach((u,i)=>{
      const tr=document.createElement('tr'); tr.innerHTML=`<td>#${i+1}</td><td>${u.id}</td><td>${u.credits}</td>`; rankPreviewTbody.appendChild(tr);
    });
  });
}
loadRankPreview();
updateStagePreview();
</script>
</body>
</html>
